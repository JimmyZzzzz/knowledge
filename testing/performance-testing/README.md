# 性能测试（Performance Testing）

性能压测是通过自动化的测试工具模拟多种正常、峰值以及异常负载条件来对系统的各项性能指标进行测试。

## 性能测试的用处

1. 新系统上线支持
   在新系统上线前，通过执行性能压测能够对系统的负载能力有较为清晰的认知，从而结合预估的潜在用户数量保障系统上线后的用户体验。
2. 技术升级验证
   在系统重构过程中，通过性能压测验证对比，可以有效验证新技术的高效性，指导系统重构。
3. 业务峰值稳定性保障
   在业务峰值到来前，通过充分的性能压测，确保大促活动等峰值业务稳定性，保障峰值业务不受损。
4. 站点容量规划
   通过性能压测实现对站点精细化的容量规划，指导分布式系统机器资源分配。预估费用
5. 性能瓶颈探测
   通过性能压测探测系统中的性能瓶颈点，进行针对性优化，从而提升系统性能。


## 性能测试的各种类型

从**测试目的**上性能测试又可以划分为负载测试、压力测试、并发测试、配置测试以及可靠性测试。
虽然也可以从别的方面对性能测试进行分类，不过我们主要就只关注这四类：

1. 负载测试(Load Testing)：测试当负载逐渐增加时，系统各项性能指标的变化情况。
2. **压力测试(Stress Testing)**：通过确定一个系统的瓶颈或者不能接受的性能点，来获得系统能提供的最大服务级别的测试。
3. 并发测试(Concurrency Testing)：通过模拟用户并发访问，测试多用户并发访问同一个软件、同一个模块或者数据记录时是否存在死锁等性能问题。
4. 配置测试(Configuration Testing)：通过对被测系统的软/硬件环境的调整，了解各种不同配置对软件系统的性能影响的程度，从而找到系统各项资源的最优分配原则。
5. 可靠性测试(Reliability Testing)/稳定性测试(Stability Testing)：在给系统加载一定业务压力的情况下，使系统运行一段时间，以此检测系统是否稳定。

大家平常挂在嘴边最多的，是**压力测试**，前面讲过的「性能测试的用处」，主要依据都是压力测试的结果。

所有的性能测试，都是在测试一定条件下，对系统施加某种程度的压力，观察在此种压力下系统的状态。因此下面将性能测试称为**性能压测**。

总的来说，性能压测是在对系统性能有一定程度了解的前提下，在确定的环境下针对压测需求进行的一种测试。


## 从零开始进行性能测试

一次完整的性能测试流程如下：

1. **确定性能压测目标**：性能压测目标可能源于项目计划、业务方需求等
2. **确定性能压测环境**：为了尽可能发挥性能压测作用，性能压测环境应当尽可能同线上环境一致
3. **确定性能压测通过标准**：针对性能压测目标以及选取的性能压测环境，制定性能压测通过标准，对于不同于线上环境的性能压测环境，通过标准也应当适度放宽
4. **设计性能压测**：编排压测链路，构造性能压测数据，尽可能模拟真实的请求链路以及请求负载
   - 所谓的全链路压测
5. **执行性能压测**：借助性能压测工具，按照设计执行性能压测
6. **分析性能压测结果报告**：分析解读性能压测结果报告，判定性能压测是否达到预期目标，若不满足，要基于性能压测结果报告分析原因


由上述步骤可知，一次成功的性能压测涉及到多个环节，从场景设计到施压再到分析，缺一不可。工欲善其事，必先利其器，而一款合适的性能工具意味着我们能够在尽可能短的时间内完成一次合理的性能压测，达到事半功倍的效果。



## 名词解释：并发、RPS 和 RT

接触性能测试的同学要理解的概念有非常多，在正文之前先跟大家就几个核心指标统一下口径：

1. 并发用户、并发、VU：一般用来表示虚拟用户（Virutal User，简称VU），对应到 Jmeter 的线程组线程，对应到 Loadrunner 的并发 Concurrency ，在本文都是一个意思。
    - 并发用户数：指同时请求系统的用户个数，或者说同一时刻，系统正在处理的请求个数。
    - 在 Locust 中，它大致对应 `wait_time = constant(0)` 的情况下（请求之间不做任何等待，以保证系统的并发数不会出现大波动），users 的个数。
2. RPS(Requests Per Second)：每秒请求数。
    - 吞吐量(Throughput)：指系统在单位时间内处理请求的数量。和这里的 RPS 基本可以等同。
    - QPS(Query Per Second): 每秒查询数：仅针对查询请求(GET)的 RPS
    - 每秒事务数 TPS(Transaction Per Second)：不单独讨论“事务”时，可以将它等同为这里的 RPS
3. 响应时间、RT：对，没错，这个就是你理解的那个意思，从发起请求到完全接收到应答的时间消耗。


## 工具

- [JMeter](https://github.com/apache/jmeter)
- [Locust](https://github.com/locustio/locust)

## 参考

- [阿里云 - 性能测试技术指南](https://help.aliyun.com/document_detail/29337.html)
- [从压测工具谈并发、压力、吞吐量](https://zhuanlan.zhihu.com/p/23211458)
- [饿了么全链路压测的探索与实践](https://zhuanlan.zhihu.com/p/30306892)
- [浅谈服务器性能测试的全生命周期——从测试、结果分析到优化策略 ](https://wetest.qq.com/lab/view/?id=102)
- [并发模式与 RPS 模式之争，性能压测领域的星球大战](https://yq.aliyun.com/articles/709950?spm=5176.7946858.1219570.2.c8802542NeDh2Z)
- [性能压测工具选型对比 - 阿里巴巴中间件](https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&mid=2247486886&idx=2&sn=cd9f4b50afd3d6a03dfeb724905ee428)
