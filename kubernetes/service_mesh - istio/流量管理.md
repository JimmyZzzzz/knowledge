# Istio 网格流量管理

网格流量分为两种：

1. 南北向流量（从 IngressGateway 进来的流量）
   1. 从抽象层面看流量路径：Gateway -> VirtualService -> DestinationRule( 覆盖 Service 配置) -> Pod
   2. 从容器层面看流量路径：IngressGateway(gateway+virtualservice+destiantionrule) -> Pod(Sidecar -> Container)
2. 东西向流量（其实就是去掉 gateway）：VirtualService -> DestinationRule( 覆盖 Service 配置) -> Pod

VirtualService 的 gateways 字段指定网关名称，网关名称有一个保留属性——**mesh**，表示所有集群内的流量。
如果要对集群内部的流量进行切分，就必须在 gateways 添加上 **mesh**！


DestinationRule 是一个负载均衡配置，它使用 Label 对 endpoints （在 k8s 中就是 Pod）进行分类。
并且它的规则将覆盖掉 K8s 自带的 Service 的规则。

而 VirtualService 可以根据配置将流量按比例分配给各类 subset，这个规则是在 SideCar/Gateway 中生效的。
当 VirutalService 的 gateways 列表中包含有 `mesh` 时，VirutalService 配置将会被分发到网格中所有的 SideCar。
当 VirutalService 的 gateways 列表中包含有 `xxxgateway` 时，VirutalService 配置将会被分发到对应的 Gateway 容器中。


